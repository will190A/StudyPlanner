"use strict";(()=>{var e={};e.id=7072,e.ids=[7072],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13712:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>h,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>y,staticGenerationAsyncStorage:()=>g});var n={};r.r(n),r.d(n,{DELETE:()=>l});var o=r(49303),s=r(88716),i=r(60670),a=r(87070),u=r(5112),d=r(75748);async function l(e,{params:t}){try{await (0,d.v)();let r=t.id;if(!r)return a.NextResponse.json({error:"缺少题库ID"},{status:400});let{searchParams:n}=new URL(e.url),o=n.get("name");if(!o){let e=(await c()).find(e=>e.id.startsWith(r));if(!e)return a.NextResponse.json({error:"找不到指定ID的题库"},{status:404});o=e.name}let s=await u.Z.deleteMany({tags:o});return a.NextResponse.json({success:!0,message:"题库删除成功",deletedCount:s.deletedCount})}catch(e){return console.error("删除自定义题库失败:",e),a.NextResponse.json({error:"删除题库失败"},{status:500})}}async function c(){let e=await u.Z.find({tags:{$regex:/^自定义/}}),t=new Map;return e.forEach(e=>{let r=e.tags.find(t=>"自定义"!==t&&e.tags.includes("自定义"));if(r){if(t.has(r)){let n=t.get(r);n.questionCount+=1,n.categories.includes(e.category)||n.categories.push(e.category)}else t.set(r,{id:Math.random().toString(36).substring(2,10),name:r,questionCount:1,categories:[e.category],createdAt:e.createdAt})}}),Array.from(t.values())}let p=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/questions/custom/[id]/route",pathname:"/api/questions/custom/[id]",filename:"route",bundlePath:"app/api/questions/custom/[id]/route"},resolvedPagePath:"D:\\武欣宇\\大三下\\计算机设计大赛\\StudyPlanner2\\src\\app\\api\\questions\\custom\\[id]\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:y}=p,f="/api/questions/custom/[id]/route";function h(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:g})}},75748:(e,t,r)=>{r.d(t,{Z:()=>d,v:()=>u});var n=r(11185),o=r.n(n);let s=process.env.MONGODB_URI||"mongodb://localhost:27017/studyplanner";if(!s)throw Error("Please define the MONGODB_URI environment variable inside .env");let i=global.mongoose;async function a(){if(i||(i=global.mongoose={conn:null,promise:null}),i.conn)return i.conn;i.promise||(i.promise=o().connect(s,{bufferCommands:!1}).then(e=>i));try{i.conn=await i.promise}catch(e){throw i.promise=null,e}return i.conn}i||(i=global.mongoose={conn:null,promise:null});let u=a,d=a},5112:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(11185),o=r.n(n);let s=new n.Schema({title:{type:String,required:!0},content:{type:String,required:!0},type:{type:String,required:!0,enum:["choice","multiple","judge","fill","code"]},category:{type:String,required:!0},subcategory:{type:String},difficulty:{type:String,required:!0,enum:["easy","medium","hard"]},options:[{label:{type:String,required:!0},text:{type:String,required:!0}}],answer:{type:n.Schema.Types.Mixed,required:!0},explanation:{type:String,required:!0},tags:[{type:String}]},{timestamps:!0}),i=o().models.Question||o().model("Question",s)}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9276,5972],()=>r(13712));module.exports=n})();