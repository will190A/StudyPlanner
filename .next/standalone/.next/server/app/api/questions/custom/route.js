"use strict";(()=>{var e={};e.id=4691,e.ids=[4691],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},40021:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>S,patchFetch:()=>A,requestAsyncStorage:()=>q,routeModule:()=>x,serverHooks:()=>b,staticGenerationAsyncStorage:()=>v});var n={};r.r(n),r.d(n,{DELETE:()=>w,GET:()=>f,POST:()=>h});var o=r(49303),s=r(88716),a=r(60670),i=r(87070),u=r(5112),l=r(75748),c=r(84770);let p={randomUUID:c.randomUUID},d=new Uint8Array(256),g=d.length,m=[];for(let e=0;e<256;++e)m.push((e+256).toString(16).slice(1));let y=function(e,t,r){if(p.randomUUID&&!t&&!e)return p.randomUUID();let n=(e=e||{}).random??e.rng?.()??(g>d.length-16&&((0,c.randomFillSync)(d),g=0),d.slice(g,g+=16));if(n.length<16)throw Error("Random bytes length must be >= 16");if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=n[e];return t}return function(e,t=0){return(m[e[t+0]]+m[e[t+1]]+m[e[t+2]]+m[e[t+3]]+"-"+m[e[t+4]]+m[e[t+5]]+"-"+m[e[t+6]]+m[e[t+7]]+"-"+m[e[t+8]]+m[e[t+9]]+"-"+m[e[t+10]]+m[e[t+11]]+m[e[t+12]]+m[e[t+13]]+m[e[t+14]]+m[e[t+15]]).toLowerCase()}(n)};async function f(e){try{await (0,l.v)();let{searchParams:t}=new URL(e.url);if(!t.get("userId"))return i.NextResponse.json({error:"缺少用户ID参数"},{status:400});let r=await u.Z.find({tags:{$regex:/^自定义/}}),n=new Map;r.forEach(e=>{let t=e.tags.find(t=>"自定义"!==t&&e.tags.includes("自定义"));if(t){if(n.has(t)){let r=n.get(t);r.questionCount+=1,r.categories.includes(e.category)||r.categories.push(e.category),new Date(e.createdAt)<new Date(r.createdAt)&&(r.createdAt=e.createdAt)}else n.set(t,{id:y().substring(0,8),name:t,questionCount:1,categories:[e.category],createdAt:e.createdAt})}});let o=Array.from(n.values()).sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime());return i.NextResponse.json({libraries:o})}catch(e){return console.error("获取自定义题库失败:",e),i.NextResponse.json({error:"获取题库失败"},{status:500})}}async function h(e){try{await (0,l.v)();let{libraryName:t,questions:r,userId:n}=await e.json();if(!t||!r||!Array.isArray(r)||0===r.length)return i.NextResponse.json({error:"参数错误：缺少题库名称或题目"},{status:400});let o=r.map(e=>{let r="choice";"multiple"===e.type?r="multiple":"judge"===e.type?r="judge":"fill"===e.type?r="fill":"essay"===e.type&&(r="code");let n=[];return("choice"===r||"multiple"===r)&&(n=Array.isArray(e.options)?e.options.map((e,t)=>({label:String.fromCharCode(65+t),text:e})):[]),{title:`${t} - 题目 ${y().substring(0,8)}`,content:e.content||"",type:r,category:e.subject||t,difficulty:"medium",options:n,answer:e.answer||"",explanation:e.analysis||"",tags:["自定义",t]}}),s=await u.Z.insertMany(o);return i.NextResponse.json({success:!0,message:"题目保存成功",count:s.length,libraryName:t})}catch(e){return console.error("保存自定义题目时出错:",e),i.NextResponse.json({error:"保存题目失败"},{status:500})}}async function w(e){try{await (0,l.v)();let{searchParams:t}=new URL(e.url),r=t.get("name");if(!r)return i.NextResponse.json({error:"缺少题库名称参数"},{status:400});let n=await u.Z.deleteMany({tags:r});return i.NextResponse.json({success:!0,message:"题库删除成功",deletedCount:n.deletedCount})}catch(e){return console.error("删除自定义题库失败:",e),i.NextResponse.json({error:"删除题库失败"},{status:500})}}let x=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/questions/custom/route",pathname:"/api/questions/custom",filename:"route",bundlePath:"app/api/questions/custom/route"},resolvedPagePath:"D:\\武欣宇\\大三下\\计算机设计大赛\\StudyPlanner2\\src\\app\\api\\questions\\custom\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:q,staticGenerationAsyncStorage:v,serverHooks:b}=x,S="/api/questions/custom/route";function A(){return(0,a.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:v})}},75748:(e,t,r)=>{r.d(t,{Z:()=>l,v:()=>u});var n=r(11185),o=r.n(n);let s=process.env.MONGODB_URI||"mongodb://localhost:27017/studyplanner";if(!s)throw Error("Please define the MONGODB_URI environment variable inside .env");let a=global.mongoose;async function i(){if(a||(a=global.mongoose={conn:null,promise:null}),a.conn)return a.conn;a.promise||(a.promise=o().connect(s,{bufferCommands:!1}).then(e=>a));try{a.conn=await a.promise}catch(e){throw a.promise=null,e}return a.conn}a||(a=global.mongoose={conn:null,promise:null});let u=i,l=i},5112:(e,t,r)=>{r.d(t,{Z:()=>a});var n=r(11185),o=r.n(n);let s=new n.Schema({title:{type:String,required:!0},content:{type:String,required:!0},type:{type:String,required:!0,enum:["choice","multiple","judge","fill","code"]},category:{type:String,required:!0},subcategory:{type:String},difficulty:{type:String,required:!0,enum:["easy","medium","hard"]},options:[{label:{type:String,required:!0},text:{type:String,required:!0}}],answer:{type:n.Schema.Types.Mixed,required:!0},explanation:{type:String,required:!0},tags:[{type:String}]},{timestamps:!0}),a=o().models.Question||o().model("Question",s)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9276,5972],()=>r(40021));module.exports=n})();