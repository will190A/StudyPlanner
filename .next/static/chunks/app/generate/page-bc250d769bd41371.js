(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[811],{2873:function(e,r,t){Promise.resolve().then(t.bind(t,9291))},9291:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return S}});var a=t(7437),n=t(2265),s=t(9376),i=t(2371),l=t(605),o=t(2381),d=t(9820),c=t(5060),u=t(3541),f=t(1047),m=t(3448),p=t(2451),g=t(407),h=t(2188);function x(e){let{className:r,classNames:t,showOutsideDays:n=!0,...s}=e;return(0,a.jsx)(h._W,{showOutsideDays:n,className:(0,m.cn)("p-3",r),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,m.cn)((0,o.d)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,m.cn)((0,o.d)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:e=>{let{...r}=e;return(0,a.jsx)(p.Z,{className:"h-4 w-4"})},IconRight:e=>{let{...r}=e;return(0,a.jsx)(g.Z,{className:"h-4 w-4"})}},...s})}x.displayName="Calendar";var y=t(7312);let v=y.fC,b=y.xz,j=n.forwardRef((e,r)=>{let{className:t,align:n="center",sideOffset:s=4,...i}=e;return(0,a.jsx)(y.h_,{children:(0,a.jsx)(y.VY,{ref:r,align:n,sideOffset:s,className:(0,m.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...i})})});function w(e){let{date:r,setDate:t}=e;return(0,a.jsxs)(v,{children:[(0,a.jsx)(b,{asChild:!0,children:(0,a.jsxs)(o.z,{variant:"outline",className:(0,m.cn)("w-full justify-start text-left font-normal",!r&&"text-muted-foreground"),children:[(0,a.jsx)(f.Z,{className:"mr-2 h-4 w-4"}),r?(0,u.Z)(r,"PPP"):(0,a.jsx)("span",{children:"Pick a date"})]})}),(0,a.jsx)(j,{className:"w-auto p-0",align:"start",children:(0,a.jsx)(x,{mode:"single",selected:r,onSelect:t,initialFocus:!0})})]})}j.displayName=y.VY.displayName;var N=t(8846);let _=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsxs)(N.fC,{ref:r,className:(0,m.cn)("relative flex w-full touch-none select-none items-center",t),...n,children:[(0,a.jsx)(N.fQ,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:(0,a.jsx)(N.e6,{className:"absolute h-full bg-primary"})}),(0,a.jsx)(N.bU,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]})});_.displayName=N.fC.displayName;var P=t(5937),C=t(5863),k=t(3675);function S(){let e=(0,s.useRouter)(),{data:r,status:t}=(0,l.useSession)(),{savePlan:u,updatePlan:f,isLoading:p,error:g}=(0,i.W)(),[h,x]=(0,n.useState)(""),[y,v]=(0,n.useState)(new Date),[b,j]=(0,n.useState)(()=>{let e=new Date;return e.setDate(e.getDate()+7),e}),[N,S]=(0,n.useState)(2),[D,R]=(0,n.useState)(!1),[L,z]=(0,n.useState)(!1),[T,O]=(0,n.useState)(null),F=async t=>{var a;if(t.preventDefault(),z(!0),O(null),!(null==r?void 0:null===(a=r.user)||void 0===a?void 0:a.id)){O("请先登录"),z(!1);return}let n=h.split(/[,，、\n]/).map(e=>e.trim()).filter(e=>e.length>0);if(0===n.length){O("请输入至少一个科目"),z(!1);return}try{console.log("Starting plan generation...");let t=await fetch("/api/generate-plan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subjects:n,startDate:y.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"-"),endDate:b.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"-"),dailyHours:N})}),a=await t.json();if(!t.ok)throw Error(a.error||"生成计划失败");console.log("Plan generated, saving...");let{tasks:s}=a,i={id:"",userId:r.user.id,subjects:n,startDate:y.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"-"),endDate:b.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"-"),dailyHours:N,tasks:s},l=await u(i);if(console.log("Save plan result:",l),l.success)console.log("Plan saved successfully"),e.push("/plans");else throw console.error("Failed to save plan:",l.error),Error(l.error||"保存计划失败")}catch(e){console.error("Error in handleSubmit:",e),O(e instanceof Error?e.message:"创建计划时发生错误")}finally{z(!1)}};return"loading"===t?(0,a.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,a.jsx)(C.Z,{className:"h-8 w-8 animate-spin"})}):(0,a.jsxs)("div",{className:"container mx-auto p-4 pt-16",children:[T&&(0,a.jsx)(P.bZ,{variant:"destructive",className:"mb-4",children:(0,a.jsxs)(P.X,{className:"flex items-center",children:[(0,a.jsx)("span",{className:"mr-2",children:"⚠️"}),T]})}),(0,a.jsxs)(d.Zb,{children:[(0,a.jsx)(d.Ol,{children:(0,a.jsx)(d.ll,{children:"创建学习计划"})}),(0,a.jsx)(d.aY,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(c._,{children:"输入科目"}),(0,a.jsx)(k.g,{placeholder:"请输入要学习的科目，用逗号、顿号或换行分隔。例如： 数学 英语 物理 化学",value:h,onChange:e=>x(e.target.value),className:"mt-2 min-h-[100px]",disabled:L||D}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"提示：可以输入多个科目，用逗号、顿号或换行分隔"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(c._,{children:"开始日期"}),(0,a.jsx)("div",{className:(0,m.cn)(L||D?"opacity-50":""),children:(0,a.jsx)(w,{date:y,setDate:e=>e&&v(e)})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(c._,{children:"结束日期"}),(0,a.jsx)("div",{className:(0,m.cn)(L||D?"opacity-50":""),children:(0,a.jsx)(w,{date:b,setDate:e=>e&&j(e)})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(c._,{children:"每日学习时长（小时）"}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 mt-2",children:[(0,a.jsx)(_,{value:[N],onValueChange:e=>{let[r]=e;return S(r)},min:1,max:8,step:.5,disabled:L||D}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:[N," 小时"]})]})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(o.z,{onClick:F,disabled:!h.trim()||L||D,children:L?(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(C.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"正在生成计划..."]}):"生成学习计划"})})]})})]})]})}},5937:function(e,r,t){"use strict";t.d(r,{X:function(){return d},bZ:function(){return o}});var a=t(7437),n=t(2265),s=t(535),i=t(3448);let l=(0,s.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),o=n.forwardRef((e,r)=>{let{className:t,variant:n,...s}=e;return(0,a.jsx)("div",{ref:r,role:"alert",className:(0,i.cn)(l({variant:n}),t),...s})});o.displayName="Alert",n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("h5",{ref:r,className:(0,i.cn)("mb-1 font-medium leading-none tracking-tight",t),...n})}).displayName="AlertTitle";let d=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:r,className:(0,i.cn)("text-sm [&_p]:leading-relaxed",t),...n})});d.displayName="AlertDescription"},2381:function(e,r,t){"use strict";t.d(r,{d:function(){return o},z:function(){return d}});var a=t(7437),n=t(2265),s=t(7053),i=t(535),l=t(3448);let o=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),d=n.forwardRef((e,r)=>{let{className:t,variant:n,size:i,asChild:d=!1,...c}=e,u=d?s.g7:"button";return(0,a.jsx)(u,{className:(0,l.cn)(o({variant:n,size:i,className:t})),ref:r,...c})});d.displayName="Button"},9820:function(e,r,t){"use strict";t.d(r,{Ol:function(){return l},SZ:function(){return d},Zb:function(){return i},aY:function(){return c},eW:function(){return u},ll:function(){return o}});var a=t(7437),n=t(2265),s=t(3448);let i=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:r,className:(0,s.cn)("rounded-xl border bg-card text-card-foreground shadow",t),...n})});i.displayName="Card";let l=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:r,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",t),...n})});l.displayName="CardHeader";let o=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("h3",{ref:r,className:(0,s.cn)("font-semibold leading-none tracking-tight",t),...n})});o.displayName="CardTitle";let d=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("p",{ref:r,className:(0,s.cn)("text-sm text-muted-foreground",t),...n})});d.displayName="CardDescription";let c=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:r,className:(0,s.cn)("p-6 pt-0",t),...n})});c.displayName="CardContent";let u=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:r,className:(0,s.cn)("flex items-center p-6 pt-0",t),...n})});u.displayName="CardFooter"},5060:function(e,r,t){"use strict";t.d(r,{_:function(){return d}});var a=t(7437),n=t(2265),s=t(6394),i=t(535),l=t(3448);let o=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)(s.f,{ref:r,className:(0,l.cn)(o(),t),...n})});d.displayName=s.f.displayName},3675:function(e,r,t){"use strict";t.d(r,{g:function(){return i}});var a=t(7437),n=t(2265),s=t(3448);let i=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("textarea",{className:(0,s.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...n})});i.displayName="Textarea"},2371:function(e,r,t){"use strict";t.d(r,{W:function(){return i},t:function(){return s}});var a=t(9625),n=t(6885);let s=(0,a.Ue)()(e=>({user:null,isAuthenticated:!1,login:r=>e({user:r,isAuthenticated:!0}),logout:()=>e({user:null,isAuthenticated:!1}),register:async(r,t,a)=>{try{let n=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r,email:t,password:a})}),s=await n.json();if(!n.ok)return{success:!1,error:s.error};return e({user:s,isAuthenticated:!0}),{success:!0}}catch(e){return{success:!1,error:"Registration failed"}}}})),i=(0,a.Ue)()((0,n.tJ)((e,r)=>({currentPlan:null,plans:[],isLoading:!1,error:null,setPlan:r=>e({currentPlan:r,error:null}),updateTask:async(t,a)=>{let n=r().currentPlan;if(!n)return{success:!1,error:"No plan found"};let s=n._id||n.id;if(!s)return{success:!1,error:"Plan ID is missing"};try{let r=await fetch("/api/plans/".concat(s,"/tasks/").concat(t),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({completed:a})});if(!r.ok){let e=await r.json();return{success:!1,error:e.error}}let n=await r.json();return e(e=>({currentPlan:n})),{success:!0}}catch(e){return{success:!1,error:"Failed to update task"}}},savePlan:async r=>{try{e({isLoading:!0,error:null});let t=await fetch("/api/plans",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),a=await t.json();if(!t.ok)return e({error:a.error}),{success:!1,error:a.error};if(!a._id&&!a.id)return console.error("Plan saved but missing ID:",a),{success:!1,error:"Plan saved but missing ID"};let n={...a,id:a._id||a.id,_id:a._id||a.id};return e(e=>({currentPlan:n,plans:[...e.plans,n],error:null})),{success:!0,data:n}}catch(r){return console.error("Error saving plan:",r),e({error:"Failed to save plan"}),{success:!1,error:"Failed to save plan"}}finally{e({isLoading:!1})}},updatePlan:async r=>{try{e({isLoading:!0,error:null});let t=await fetch("/api/plans/".concat(r.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),a=await t.json();if(!t.ok)return e({error:a.error}),{success:!1,error:a.error};return e(e=>({currentPlan:a,plans:e.plans.map(e=>e.id===a.id?a:e),error:null})),{success:!0}}catch(r){return e({error:"Failed to update plan"}),{success:!1,error:"Failed to update plan"}}finally{e({isLoading:!1})}},deletePlan:async r=>{try{e({isLoading:!0,error:null});let t=await fetch("/api/plans/".concat(r),{method:"DELETE"});if(!t.ok){let r=await t.json();return e({error:r.error}),{success:!1,error:r.error}}return e(e=>{var t;return{currentPlan:(null===(t=e.currentPlan)||void 0===t?void 0:t.id)===r?null:e.currentPlan,plans:e.plans.filter(e=>e.id!==r),error:null}}),{success:!0}}catch(r){return e({error:"Failed to delete plan"}),{success:!1,error:"Failed to delete plan"}}finally{e({isLoading:!1})}},fetchPlans:async r=>{try{e({isLoading:!0,error:null});let t=await fetch("/api/plans?userId=".concat(r)),a=await t.json();if(!t.ok)return e({error:a.error}),{success:!1,error:a.error};return e({plans:a,error:null}),{success:!0,data:a}}catch(r){return e({error:"Failed to fetch plans"}),{success:!1,error:"Failed to fetch plans"}}finally{e({isLoading:!1})}}}),{name:"study-plan-storage",partialize:e=>({currentPlan:e.currentPlan,plans:e.plans})}))},3448:function(e,r,t){"use strict";t.d(r,{cn:function(){return s}});var a=t(1994),n=t(3335);function s(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,n.m6)((0,a.W)(r))}}},function(e){e.O(0,[265,605,846,707,883,351,217,154,971,117,744],function(){return e(e.s=2873)}),_N_E=e.O()}]);