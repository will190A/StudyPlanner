(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[927],{4406:function(e,t,n){Promise.resolve().then(n.bind(n,8367))},401:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9763).Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},8367:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return h}});var r=n(7437),s=n(2265),i=n(9376),a=n(2371),l=n(605),c=n(2381),d=n(9820),o=n(3944),u=n(8245),f=n(5937),m=n(5863);function p(e){let{onPlanIdReceived:t}=e;return t((0,i.useSearchParams)().get("id")),null}function h(){let e=(0,i.useRouter)(),{data:t,status:n}=(0,l.useSession)(),{currentPlan:h,updateTask:x,deletePlan:v,isLoading:b,error:j,fetchPlans:N}=(0,a.W)(),[y,g]=(0,s.useState)(null),[k,w]=(0,s.useState)(!1),[E,O]=(0,s.useState)(!0);(0,s.useEffect)(()=>{if("loading"!==n){if("unauthenticated"===n){e.push("/login");return}(async()=>{if((null==t?void 0:t.user)&&y){let n=t.user.id,r=await N(n);if(r.success&&r.data){let t=r.data.find(e=>e._id===y||e.id===y);if(t){let e={...t,id:t._id||t.id,_id:t._id||t.id};a.W.getState().setPlan(e)}else e.push("/plans")}O(!1)}else null===y&&"authenticated"===n&&e.push("/plans")})()}},[n,t,e,N,y]);let R=async(e,t)=>{if(!h){console.error("No current plan found");return}if(!(h._id||h.id)){console.error("Plan ID is missing");return}try{let n=await x(e,t);n.success||console.error("Failed to update task:",n.error)}catch(e){console.error("Error updating task:",e)}},S=async()=>{if(h&&confirm("确定要删除这个学习计划吗？")){w(!0);try{let t=await v(h.id);t.success?e.push("/plans"):console.error("Failed to delete plan:",t.error)}finally{w(!1)}}};if(E)return(0,r.jsxs)("div",{className:"flex justify-center items-center min-h-screen",children:[(0,r.jsx)(s.Suspense,{fallback:null,children:(0,r.jsx)(p,{onPlanIdReceived:g})}),(0,r.jsx)(m.Z,{className:"h-8 w-8 animate-spin"})]});if(!h)return(0,r.jsxs)("div",{className:"container mx-auto p-4",children:[(0,r.jsx)(s.Suspense,{fallback:null,children:(0,r.jsx)(p,{onPlanIdReceived:g})}),(0,r.jsxs)(d.Zb,{children:[(0,r.jsx)(d.Ol,{children:(0,r.jsx)(d.ll,{children:"没有找到学习计划"})}),(0,r.jsxs)(d.aY,{children:[(0,r.jsx)("p",{children:"请选择一个现有的计划。"}),(0,r.jsx)(c.z,{onClick:()=>e.push("/plans"),className:"mt-4",children:"返回计划列表"})]})]})]});let C=h.tasks.length,M=h.tasks.filter(e=>e.completed).length,T=C>0?M/C*100:0,I=h.tasks.reduce((e,t)=>(e[t.date]||(e[t.date]=[]),e[t.date].push(t),e),{});return(0,r.jsxs)("div",{className:"container mx-auto p-4",children:[(0,r.jsx)(s.Suspense,{fallback:null,children:(0,r.jsx)(p,{onPlanIdReceived:g})}),j&&(0,r.jsx)(f.bZ,{variant:"destructive",className:"mb-4",children:(0,r.jsx)(f.X,{children:j})}),(0,r.jsxs)(d.Zb,{className:"mb-6",children:[(0,r.jsx)(d.Ol,{children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)(d.ll,{children:"学习计划进度"}),(0,r.jsx)(c.z,{variant:"destructive",onClick:S,disabled:k,children:k?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"删除中..."]}):"删除计划"})]})}),(0,r.jsx)(d.aY,{children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,r.jsx)("span",{children:"总体进度"}),(0,r.jsxs)("span",{children:[Math.round(T),"%"]})]}),(0,r.jsx)(o.E,{value:T,className:"h-2"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"总任务数"}),(0,r.jsx)("p",{className:"text-2xl font-bold",children:C})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"已完成任务"}),(0,r.jsx)("p",{className:"text-2xl font-bold",children:M})]})]})]})})]}),(0,r.jsx)("div",{className:"space-y-6",children:Object.entries(I).sort((e,t)=>{let[n]=e,[r]=t;return new Date(n).getTime()-new Date(r).getTime()}).map(e=>{let[t,n]=e;return(0,r.jsxs)(d.Zb,{children:[(0,r.jsx)(d.Ol,{children:(0,r.jsx)(d.ll,{children:new Date(t).toLocaleDateString()})}),(0,r.jsx)(d.aY,{children:(0,r.jsx)("div",{className:"space-y-4",children:n.map(e=>(0,r.jsxs)("div",{className:"flex items-center space-x-4 p-4 border rounded-lg",children:[(0,r.jsx)(u.X,{id:e.id,checked:e.completed,onCheckedChange:t=>R(e.id,t),disabled:b}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("label",{htmlFor:e.id,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 ".concat(e.completed?"line-through text-gray-500":""),children:[e.subject," - ",e.description]}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["预计时长: ",e.duration," 小时"]})]})]},e.id))})})]},t)})})]})}},8245:function(e,t,n){"use strict";n.d(t,{X:function(){return c}});var r=n(7437),s=n(2265),i=n(9270),a=n(401),l=n(3448);let c=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)(i.fC,{ref:t,className:(0,l.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",n),...s,children:(0,r.jsx)(i.z$,{className:(0,l.cn)("flex items-center justify-center text-current"),children:(0,r.jsx)(a.Z,{className:"h-4 w-4"})})})});c.displayName=i.fC.displayName},9270:function(e,t,n){"use strict";n.d(t,{fC:function(){return w},z$:function(){return E}});var r=n(2265),s=n(8575),i=n(3966),a=n(6741),l=n(886),c=n(6718),d=n(420),o=n(1599),u=n(6840),f=n(7437),m="Checkbox",[p,h]=(0,i.b)(m),[x,v]=p(m),b=r.forwardRef((e,t)=>{let{__scopeCheckbox:n,name:i,checked:c,defaultChecked:d,required:o,disabled:p,value:h="on",onCheckedChange:v,form:b,...j}=e,[N,w]=r.useState(null),E=(0,s.e)(t,e=>w(e)),O=r.useRef(!1),R=!N||b||!!N.closest("form"),[S,C]=(0,l.T)({prop:c,defaultProp:null!=d&&d,onChange:v,caller:m}),M=r.useRef(S);return r.useEffect(()=>{let e=null==N?void 0:N.form;if(e){let t=()=>C(M.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[N,C]),(0,f.jsxs)(x,{scope:n,state:S,disabled:p,children:[(0,f.jsx)(u.WV.button,{type:"button",role:"checkbox","aria-checked":g(S)?"mixed":S,"aria-required":o,"data-state":k(S),"data-disabled":p?"":void 0,disabled:p,value:h,...j,ref:E,onKeyDown:(0,a.M)(e.onKeyDown,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,a.M)(e.onClick,e=>{C(e=>!!g(e)||!e),R&&(O.current=e.isPropagationStopped(),O.current||e.stopPropagation())})}),R&&(0,f.jsx)(y,{control:N,bubbles:!O.current,name:i,value:h,checked:S,required:o,disabled:p,form:b,style:{transform:"translateX(-100%)"},defaultChecked:!g(d)&&d})]})});b.displayName=m;var j="CheckboxIndicator",N=r.forwardRef((e,t)=>{let{__scopeCheckbox:n,forceMount:r,...s}=e,i=v(j,n);return(0,f.jsx)(o.z,{present:r||g(i.state)||!0===i.state,children:(0,f.jsx)(u.WV.span,{"data-state":k(i.state),"data-disabled":i.disabled?"":void 0,...s,ref:t,style:{pointerEvents:"none",...e.style}})})});N.displayName=j;var y=r.forwardRef((e,t)=>{let{__scopeCheckbox:n,control:i,checked:a,bubbles:l=!0,defaultChecked:o,...m}=e,p=r.useRef(null),h=(0,s.e)(p,t),x=(0,c.D)(a),v=(0,d.t)(i);r.useEffect(()=>{let e=p.current;if(!e)return;let t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(x!==a&&t){let n=new Event("click",{bubbles:l});e.indeterminate=g(a),t.call(e,!g(a)&&a),e.dispatchEvent(n)}},[x,a,l]);let b=r.useRef(!g(a)&&a);return(0,f.jsx)(u.WV.input,{type:"checkbox","aria-hidden":!0,defaultChecked:null!=o?o:b.current,...m,tabIndex:-1,ref:h,style:{...m.style,...v,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function g(e){return"indeterminate"===e}function k(e){return g(e)?"indeterminate":e?"checked":"unchecked"}y.displayName="CheckboxBubbleInput";var w=b,E=N},1599:function(e,t,n){"use strict";n.d(t,{z:function(){return a}});var r=n(2265),s=n(8575),i=n(1188),a=e=>{var t,n;let a,c;let{present:d,children:o}=e,u=function(e){var t,n;let[s,a]=r.useState(),c=r.useRef({}),d=r.useRef(e),o=r.useRef("none"),[u,f]=(t=e?"mounted":"unmounted",n={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},r.useReducer((e,t)=>{let r=n[e][t];return null!=r?r:e},t));return r.useEffect(()=>{let e=l(c.current);o.current="mounted"===u?e:"none"},[u]),(0,i.b)(()=>{let t=c.current,n=d.current;if(n!==e){let r=o.current,s=l(t);e?f("MOUNT"):"none"===s||(null==t?void 0:t.display)==="none"?f("UNMOUNT"):n&&r!==s?f("ANIMATION_OUT"):f("UNMOUNT"),d.current=e}},[e,f]),(0,i.b)(()=>{if(s){var e;let t;let n=null!==(e=s.ownerDocument.defaultView)&&void 0!==e?e:window,r=e=>{let r=l(c.current).includes(e.animationName);if(e.target===s&&r&&(f("ANIMATION_END"),!d.current)){let e=s.style.animationFillMode;s.style.animationFillMode="forwards",t=n.setTimeout(()=>{"forwards"===s.style.animationFillMode&&(s.style.animationFillMode=e)})}},i=e=>{e.target===s&&(o.current=l(c.current))};return s.addEventListener("animationstart",i),s.addEventListener("animationcancel",r),s.addEventListener("animationend",r),()=>{n.clearTimeout(t),s.removeEventListener("animationstart",i),s.removeEventListener("animationcancel",r),s.removeEventListener("animationend",r)}}f("ANIMATION_END")},[s,f]),{isPresent:["mounted","unmountSuspended"].includes(u),ref:r.useCallback(e=>{e&&(c.current=getComputedStyle(e)),a(e)},[])}}(d),f="function"==typeof o?o({present:u.isPresent}):r.Children.only(o),m=(0,s.e)(u.ref,(a=null===(t=Object.getOwnPropertyDescriptor(f.props,"ref"))||void 0===t?void 0:t.get)&&"isReactWarning"in a&&a.isReactWarning?f.ref:(a=null===(n=Object.getOwnPropertyDescriptor(f,"ref"))||void 0===n?void 0:n.get)&&"isReactWarning"in a&&a.isReactWarning?f.props.ref:f.props.ref||f.ref);return"function"==typeof o||u.isPresent?r.cloneElement(f,{ref:m}):null};function l(e){return(null==e?void 0:e.animationName)||"none"}a.displayName="Presence"},6718:function(e,t,n){"use strict";n.d(t,{D:function(){return s}});var r=n(2265);function s(e){let t=r.useRef({value:e,previous:e});return r.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}},420:function(e,t,n){"use strict";n.d(t,{t:function(){return i}});var r=n(2265),s=n(1188);function i(e){let[t,n]=r.useState(void 0);return(0,s.b)(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});let t=new ResizeObserver(t=>{let r,s;if(!Array.isArray(t)||!t.length)return;let i=t[0];if("borderBoxSize"in i){let e=i.borderBoxSize,t=Array.isArray(e)?e[0]:e;r=t.inlineSize,s=t.blockSize}else r=e.offsetWidth,s=e.offsetHeight;n({width:r,height:s})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}n(void 0)},[e]),t}}},function(e){e.O(0,[265,605,846,883,252,971,117,744],function(){return e(e.s=4406)}),_N_E=e.O()}]);